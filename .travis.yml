language: c
compiler:
    - gcc
before_install:
    - sudo apt-get update -y
    - sudo apt-get install -y build-essential libtool autoconf pkg-config check gcovr lcov git
    - sudo gem install coveralls-lcov
script:
    - libtoolize
    - autoreconf -i
    - ./configure CFLAGS="-g -O0"
    - make
    - CK_TAP_LOG_FILE_NAME=test-suite.tap make check
    - cat test/test-suite.tap
after_success:
    - mkdir -p coverage
    - lcov --base-directory src --directory . -c -o coverage/lcov.info
    - lcov --remove coverage/lcov.info "*/check_*.c" -o coverage/lcov.info
    - coveralls-lcov coverage/lcov.info
after_failure:
    - cat test/*.log
    - cat test/test-suite.tap
